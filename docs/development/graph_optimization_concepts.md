# InsightSpike グラフ最適化の概念と設計

## 目次

1. [エピソード関係性とメッセージパッシング](#エピソード関係性とメッセージパッシング)
2. [グラフ構築フローの比較](#グラフ構築フローの比較)
3. [概念ブリッジング](#概念ブリッジング)
4. [仮説駆動型アプローチ](#仮説駆動型アプローチ)
5. [理解と閃きの違い](#理解と閃きの違い)
6. [実装への道筋](#実装への道筋)

---

## エピソード関係性とメッセージパッシング

### エピソード間の関係性による影響

エピソード間の関係性（類似度）によって、メッセージパッシングの出力は劇的に変化します。

#### 1. 強い関連性（類似度 > 0.7）
```
Episode A ━━━ Episode B
         (密な連結)

結果:
- グラフ密度: 100%
- 洞察スパイク: 検出される
- プロンプト長: ~800文字
- C値報酬: 1.5倍に増加
```

#### 2. 弱い関連性（類似度 < 0.7）
```
Episode A     Episode B
  (孤立)       (孤立)

結果:
- グラフ密度: 0%
- 洞察スパイク: 検出されない
- プロンプト長: ~300文字
- C値報酬: 変化なし
```

### 重要なメカニズム

**エッジ形成の閾値（0.7）**
- 類似度 0.69: ❌ エッジなし → 洞察検出なし
- 類似度 0.71: ✅ エッジ形成 → 洞察検出の可能性

わずか0.02の差が出力を劇的に変える！

**C値報酬システム**
```python
if insight_spike_detected:
    base_reward = min(delta_ged.abs() + delta_ig, 1.0)
    c_value_new = c_value_old + 0.9 * base_reward
else:
    c_value_new = c_value_old * 0.99  # 減衰
```

---

## グラフ構築フローの比較

### 現在の実装フロー

1. **類似度ベースのエッジ作成（即座に確定）**
   - FAISSで各ノードのtop-k近傍を検索
   - 類似度 > 0.7 なら即座にエッジ作成
   - エッジは永続的（仮配線ではない）

2. **グラフ分析フェーズ**
   - 現在のグラフと前回のグラフを比較
   - ΔGED計算（構造変化の測定）
   - ΔIG計算（情報利得の測定）

3. **評価と学習**
   - メトリクスは評価のみ（エッジ変更なし）
   - 洞察スパイク検出
   - C値報酬の更新

### 提案フロー（仮結線→評価→採用）

1. **仮エッジ作成**
   - 類似度ベースで仮のエッジを作成

2. **GED最適化**
   - 仮エッジでGEDを計算
   - GEDが改善する方向のエッジのみ採用
   - エッジ構造を最適化

3. **IG計算**
   - 確定したエッジでIG計算

### なぜ現在の実装なのか？

- **計算効率**: 仮エッジの最適化は計算コストが高い
- **シンプルさ**: 類似度0.7の明確な閾値
- **実用性**: 0.7以上なら十分に関連性が高い

---

## 概念ブリッジング

### 人間の思考プロセス

人間は直接関連のない概念を結びつけるために「中間概念」を活用します。

#### 具体例

**科学的発見**
```
リンゴ 🍎 ← [重力] → 月 🌙
直接の類似度: 低い（0.2）
```

**バイオミメティクス**
```
コウモリ 🦇 ← [エコーロケーション] → 潜水艦 🚢
直接の類似度: 低い（0.15）
```

**組織論**
```
蟻のコロニー 🐜 ← [群知能] → インターネット 🌐
直接の類似度: 低い（0.1）
```

### ハイブリッドアプローチ

実際の思考では、新しい概念を作るよりも、既存の知識から適切な「つなぎ役」を見つけることの方が一般的です。

#### 1. 既存エピソード探索（80%のケース）
- 計算コストが低い（埋め込み比較のみ）
- 信頼性が高い（実在する知識）
- 予期しない関連性の発見

#### 2. 仮説生成（20%のケース）
- 「もしかしたら、こういう概念でつながるのでは？」という仮説
- 検証が必要な推測的なブリッジ
- 検証されれば新しい知識としてエピソード化

### よくあるブリッジパターン

| パターン | 例 | 特徴 | 頻度 |
|---------|-----|------|------|
| 抽象化ブリッジ | 鳥 ← [飛行の原理] → 飛行機 | 具体から抽象への一般化 | 高 |
| 技術転用ブリッジ | コウモリ ← [エコーロケーション] → ソナー | 自然界の仕組みを技術に応用 | 中 |
| 構造類似ブリッジ | 蟻コロニー ← [群知能] → インターネット | 異なる領域の構造的類似性 | 中 |
| 因果関係ブリッジ | リンゴ ← [重力] → 月の軌道 | 共通の原因や法則 | 低 |

---

## 仮説駆動型アプローチ

### 仮説生成 vs 新規概念生成

**❌ 新規概念生成（誤解されやすいアプローチ）**
- 「グラビトン」（架空の重力子）を創造
- 実在しない概念を作ってしまう

**✅ 仮説生成（より適切なアプローチ）**
- 「もしかして、同じ力が働いているのでは？」（仮説）
- 検証可能で、実世界に根ざした推論

### 仮説のライフサイクル

1. **仮説生成（Hypothesis）**
   - 状態: tentative
   - 信頼度: 0.3
   - 用途: 探索的推論

2. **部分検証（Partially Validated）**
   - 状態: promising
   - 信頼度: 0.6
   - 用途: 条件付き推論

3. **検証済み（Validated）**
   - 状態: confirmed
   - 信頼度: 0.9
   - 用途: 通常の推論

4. **知識化（Knowledge）**
   - 状態: established
   - 信頼度: 1.0
   - 用途: エピソードとして保存

### メッセージパッシングによる仮説生成

グラフの「空白地帯」の近傍エピソードからメッセージパッシングで仮説を生成します。

```
Episode A                    [空白地帯]                    Episode B
    ↓                            ↑                             ↓
メッセージ→ → → → → → → → ← ← ← ← ← ← ← ←メッセージ
                      ↗    ↑    ↖
                    ↗      ↑      ↖
                  ↗        ↑        ↖
              近傍1      近傍2      近傍3
                ↓          ↓          ↓
            メッセージ  メッセージ  メッセージ

空白地帯で収束 → 仮説概念の創発
```

**プロセス**
1. 空白地帯の中心を特定
2. 近傍エピソードを収集
3. 三方向からのメッセージが交わる
4. 共通概念が強化される
5. バランスの取れた位置で安定
6. 新しい概念（仮説）が創発

---

## 理解と閃きの違い

### 📚 理解（Understanding）- 現在のGED/IG

**例: 生物分類の理解**
```
犬は哺乳類 ┐
          ├→ 階層構造を認識
猫は哺乳類 ┘

結果:
動物
├─ 哺乳類
│   ├─ 犬
│   └─ 猫
└─ 鳥
```

**特徴**
- 既存の関係性を整理・体系化
- 論理的、順序的、分析的
- 予測可能性: 高い

### 💡 閃き（Eureka）- メッセージパッシング

**例: コウモリと潜水艦の関連性**
```
コウモリ（超音波）←X→ 潜水艦（？）
        ↓              ↓
        → 空白地帯 ←
            ↓
    「エコーロケーション」創発！
```

**特徴**
- 新しい関連性の創発
- 直感的、全体的、創造的
- 予測可能性: 低い

### 比較表

| 側面 | 理解 | 閃き |
|------|------|------|
| トリガー | 類似性の高いエピソード | 類似性の低いエピソード |
| プロセス | 段階的・分析的 | 非線形・創発的 |
| メカニズム | GED/IG評価 | メッセージパッシング |
| 結果 | 既存パターンの認識 | 新しい関連性の発見 |
| 例 | 分類、階層化、体系化 | アナロジー、メタファー、発明 |
| 計算コスト | 低い | 高い |

---

## 実装への道筋

### 統合アーキテクチャ

```
InsightSpike 知的プロセスアーキテクチャ
┌────────────────────────────────────────────┐
│                                            │
│  1. 理解プロセス（Understanding）           │
│     ├─ 類似度ベースのエッジ形成            │
│     ├─ GED評価（構造の改善）              │
│     └─ IG評価（情報の体系化）             │
│                                            │
│  2. 閃きプロセス（Insight/Eureka）         │
│     ├─ グラフ空白地帯の検出               │
│     ├─ メッセージパッシング               │
│     └─ 仮説の創発と検証                   │
│                                            │
└────────────────────────────────────────────┘
```

### 実装優先順位

1. **仮説駆動型グラフ構築**
   - 仮結線→評価→採用/棄却のフロー
   - エッジタイプの拡張（直接、既存ブリッジ、仮説ブリッジ）

2. **メッセージパッシング機構**
   - 空白地帯検出アルゴリズム
   - 近傍からのメッセージ集約
   - 収束による仮説創発

3. **統合スパイク検出**
   - 理解スパイク（既存）
   - 閃きスパイク（新規）
   - モード選択メカニズム

### 期待される効果

- **より人間的な知的プロセス**: 分析と創造の両立
- **新しい知識発見**: 既存知識の整理だけでなく、新しい関連性の創出
- **説明可能性の向上**: 理解による発見と閃きによる発見の区別

---

*このドキュメントは、InsightSpikeのグラフ最適化に関する概念と設計をまとめたものです。*
*Last Updated: 2024-01-19*