# Wake Mode Structure Insights: Star vs Quadrilateral

## 概要
Wake modeにおける近傍ノード選択と洞察生成の構造的な違いについての考察。

## スター構造 vs 四角形構造

### スター構造（現在の実装）
```
    Node1
      |
Query--+--Node2
      |
    Node3
```

- **特徴**: クエリが中心（ハブ）となり、選択されたノードが周囲に配置
- **洞察の位置**: クエリ位置に生成される
- **問題点**: クエリ位置での洞察生成は新しい価値を生まない（既にある位置）

### 四角形構造（提案）
```
Query --- Node1
  |         |
  |    ★    |
  |         |
Node2 --- Node3
```

- **特徴**: クエリと選択ノードが多角形を形成
- **洞察の位置**: 幾何学的中心（★）に生成される
- **利点**: 新しい位置に新しい価値（洞察）が生まれる

## 連想ゲームとしての自然さ

四角形構造は人間の連想プロセスにより近い：

1. **出発点（クエリ）**: 「リンゴ」
2. **連想1（Node1）**: 「赤い」
3. **連想2（Node2）**: 「果物」
4. **連想3（Node3）**: 「健康的」
5. **洞察（中心）**: 「栄養価の高い赤い果物」

この構造では、各要素から等距離の位置に新しい概念が生まれる。

## メッセージパッシングの再考

### 現在の理解
- 複雑なメッセージパッシングアルゴリズム
- ノード間の情報伝播

### 新しい理解：重心計算
空間把握としてのgeDIGでは、メッセージパッシングは以下と等価：

```python
# 従来のメッセージパッシング（複雑）
for node in selected_nodes:
    messages = collect_messages_from_neighbors(node)
    node.update(messages)

# 等価な重心計算（シンプル）
insight_position = weighted_centroid([query] + selected_nodes)
```

### 重み付き重心の意味
- 各ノードの重要度（距離の逆数など）で重み付け
- クエリにより高い重みを与えることも可能
- 結果として得られる位置が「洞察」の位置

## 実装への示唆

1. **洞察生成位置の明示化**
   - 現在: クエリ位置（価値が低い）
   - 提案: 幾何学的中心（新しい価値）

2. **メッセージパッシングの簡略化**
   - 複雑なアルゴリズムを重心計算に置き換え
   - 計算効率の大幅な向上

3. **視覚化の改善**
   - スター構造vs四角形構造を明確に表示
   - 洞察の生成位置を可視化

## 数学的定式化

### スター構造での洞察位置
```
I_star = Q  （クエリ位置と同じ）
```

### 四角形構造での洞察位置
```
I_quad = Σ(w_i * p_i) / Σ(w_i)

ここで:
- p_i: 各ノード（クエリ含む）の位置ベクトル
- w_i: 各ノードの重み（例: 1/distance）
```

## 今後の研究課題

1. **重み設計**
   - 距離ベースの重み
   - 意味的関連性ベースの重み
   - ハイブリッド重み

2. **構造の動的選択**
   - タスクに応じてスター/四角形を切り替え
   - より複雑な多角形構造の探索

3. **実験的検証**
   - 両構造での洞察の質の比較
   - 人間の連想プロセスとの整合性評価

## 関連ファイル
- `/experiments/pre-experiment/results/distance_search_insights.md` - 距離ベース検索の実験結果
- `/docs/research/thinking/magic_circles_and_cognition.md` - 魔法陣と認知の考察
- `/src/insightspike/query/sphere_search.py` - 現在の実装