# 仮説：ベクトル空間でのgeDIG最適化

## 作成日：2025-01-29

## 背景
現在のgeDIG実装では、クエリ評価時に既存ノードの組み合わせから最適なものを探索している。しかし、これは離散的な探索に限定され、真の最適解を見逃す可能性がある。

## 仮説
**geDIGが最降下するポイントのベクトル位置を、探索ではなくベクトル空間から直接導出できるのではないか？**

## 現状の問題点
1. 離散的な探索（既存ノードの組み合わせに限定）
2. 局所最適解に陥りやすい
3. 計算コストが高い（組み合わせ爆発）
4. 真の最適点が既存ノードの間にある場合、見つけられない

## 提案手法

### アプローチ1：勾配降下法
```python
# クエリベクトルから開始して、エネルギー関数 F = w1*ΔGED - kT*ΔIG を最小化
optimal_vector = gradient_descent(query_vector, current_graph)
```

### アプローチ2：解析的手法
```python
# グラフラプラシアンの固有値分解を使用
# スペクトル領域で最適係数を計算し、元の空間に戻す
optimal_vector = analytical_solution(query_vector, graph_laplacian)
```

## 期待される効果
1. 連続空間での最適化により、より良い解を発見
2. 計算効率の向上（組み合わせ探索不要）
3. 理論的に健全な最適化（エネルギー最小化原理）
4. 新しい知識の「理想的な位置」を直接計算可能

## 検証すべき点
1. 微分可能なgeDIG近似の精度
2. 最適化の収束性
3. 実際のスパイク検出性能への影響
4. 計算コストの実測値

## 実装状況
- [ ] VectorSpaceGeDIGクラスの基本実装完了
- [ ] 単体テストの作成
- [ ] 既存システムへの統合
- [ ] 性能評価実験

## メモ
- エネルギー関数の設計が重要（GED成分とIG成分のバランス）
- 正規化により安定性を保証する必要がある
- グラフが大規模になった場合の効率的な実装も検討必要

## 追加の洞察（2025-01-29）

### 勾配場アプローチ
**最初に周りのノードを比較する必要もないのかもしれない。ベクトル空間にベクトル次元-1次元のgeDIG関数で定義される勾配平面を定義すれば、勾配に沿って安定点まで転がり落ちればいい。**

#### 概念
- n次元ベクトル空間に(n-1)次元のgeDIG等高面を定義
- 各点でのgeDIG勾配が決まる
- クエリベクトルから勾配に沿って転がり落ちる

#### 利点
1. **初期探索不要** - 近傍ノードを調べる必要がない
2. **連続的な最適化** - ベクトル空間全体にgeDIG場を定義
3. **物理的な直感** - ポテンシャル場として理解可能
   - 谷（安定点）= 良い知識の配置
   - 丘（不安定点）= 冗長または無関係な配置
4. **計算効率** - O(n)の勾配計算、自動微分により効率的

#### 実装アイデア
```python
# geDIG場を定義
field_value = w1 * ged_from_manifold(point) - kT * information_potential(point)

# 勾配に沿って安定点へ
stable_point = gradient_descent(query_vector, gedig_field)
```

## 注意事項
**ただし既存理論との飛躍が激しすぎる為、研究方法、提示段階は要検討**

### 懸念点
1. グラフ編集距離の連続近似の妥当性検証が必要
2. 情報理論的な正当性の証明が必要
3. 既存のグラフ理論との接続が不明確
4. 実験的検証なしに理論だけが先行している

### 段階的アプローチの提案
1. **第1段階**: 既存手法での実験結果を確立
2. **第2段階**: 連続近似の妥当性を小規模実験で検証
3. **第3段階**: 理論的基礎を固めてから本格実装
4. **第4段階**: 既存手法との比較評価

## 関連ファイル
- `/src/insightspike/algorithms/vector_space_gedig.py` - ベクトル空間最適化の実装
- `/src/insightspike/algorithms/gedig_gradient_field.py` - 勾配場アプローチの実装
- `/src/insightspike/algorithms/gedig_core.py` - 現在のgeDIG実装