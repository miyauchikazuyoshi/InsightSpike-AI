# 迷路ナビゲーション実験設計

## 概要
geDIG（ΔIG-ΔGED内発報酬）の汎用性とモーダル非依存性を実証する迷路探索実験

## 実験の狙い
1. **勾配場の可視化** - 探索がリング状に広がり、高ΔIGノードに収束する様子を動的に表示
2. **理論の具現化** - 壁破り=ΔGED、新マス発見=ΔIGという直感的な対応
3. **モーダル非依存性** - テキスト・画像・音声で同一の挙動を示す

## 実験設定

### 環境
- **迷路サイズ**: 20×20グリッド（スケーラビリティテストで40×40も）
- **壁の割合**: 30%（ランダム配置）
- **スタート/ゴール**: 固定または複数パターン
- **行動空間**: 上下左右移動 + 壁破り（コスト大）

### 観測モーダル

#### 1. テキスト版
```python
observation = f"Position: ({x}, {y}), Walls: N={north} S={south} E={east} W={west}"
embedding = sentence_transformer.encode(observation)
```

#### 2. 画像版
```python
# 各マスに視覚的特徴（色、パターン、アイコン）
observation = maze_tile_images[x, y]  # 64x64 RGB
embedding = clip_model.encode_image(observation)
```

#### 3. 音声版
```python
# 位置ごとに異なる音パターン
observation = position_sounds[x, y]  # 1秒のビープ音
embedding = wav2vec_model.encode(observation)
```

### 報酬設計
```python
# 内発報酬のみ
R_t = λ * Z_score(ΔIG_t) - μ * ΔGED_normalized_t

# ΔIG: 新規マスの情報価値
ΔIG = 1 - cosine_similarity(current_embedding, visited_embeddings.mean())

# ΔGED: グラフ構造の変化コスト
ΔGED = {
    'move': 0.1,      # 通常移動
    'wall_break': 1.0  # 壁破り
}
```

### 評価指標

1. **効率性**
   - ゴール到達ステップ数
   - 探索カバー率
   - 壁破り回数

2. **勾配場の質**
   - ΔIG/ΔGED推移
   - リング拡散パターン
   - 収束速度

3. **モーダル間一貫性**
   - 3モーダルでの挙動類似度
   - 符号反転テストの再現性

## 実験手順

### Phase 1: 単一モーダル検証
1. テキスト版で基本動作確認
2. パラメータ調整（λ, μ, 正規化）
3. ベースライン比較（Q-learning, ランダム）

### Phase 2: マルチモーダル展開
1. 画像版・音声版の実装
2. 同一迷路での3モーダル比較
3. 統計的有意性検証

### Phase 3: スケーラビリティ
1. 迷路サイズ拡大（40×40, 60×60）
2. 複雑な迷路構造（複数経路、部屋構造）
3. 計算効率の評価

## 可視化計画

### リアルタイム表示（Streamlit）
```
[迷路マップ]              [メトリクス]
□□■□□□□               ΔIG: ████████ 0.82
□●◯◯□■□               ΔGED: ██ 0.23  
□◯★◯□□□               Reward: ███████ 0.71
□□□□□□□               Steps: 127

● 現在位置  ◯ 訪問済み  ★ 高ΔIGノード
```

### 論文用Figure
- Figure 3a: 3モーダルの探索軌跡比較
- Figure 3b: ΔIG/ΔGED推移グラフ
- Figure 3c: 符号反転での挙動差（GIFアニメーション）

## 期待される結果

1. **定量的**
   - 内発報酬のみで外部報酬ありと同等の効率
   - モーダル間でのステップ数差が±10%以内
   - 符号反転で100%の挙動差

2. **定性的**
   - リング状探索の明確な可視化
   - 高情報価値領域への自然な収束
   - 壁破りの戦略的使用

## 実装タイムライン

1. **Week 1**: 基本環境とテキスト版
2. **Week 2**: マルチモーダル拡張
3. **Week 3**: 可視化とベースライン比較
4. **Week 4**: 論文用図表作成

## コード構造
```
experiments/maze_navigation/
├── environments/
│   ├── maze_env.py          # 基本迷路環境
│   ├── multi_modal_maze.py  # モーダル対応
│   └── visualizer.py        # Streamlit可視化
├── agents/
│   ├── gedig_agent.py       # 内発報酬エージェント
│   └── baselines.py         # Q-learning等
├── encoders/
│   ├── text_encoder.py
│   ├── image_encoder.py
│   └── audio_encoder.py
└── run_experiments.py       # 実験実行スクリプト
```

## 符号逆転テスト（重要）

### 実験設計
同一環境・同一パラメータで報酬の符号のみを反転させ、挙動の違いを検証

#### 条件設定
```python
# 6条件 = 3モーダル × 2符号
conditions = [
    ("text", +1),   # テキスト・正符号（Maximizer）
    ("text", -1),   # テキスト・負符号（Minimizer）
    ("image", +1),  # 画像・正符号
    ("image", -1),  # 画像・負符号  
    ("audio", +1),  # 音声・正符号
    ("audio", -1),  # 音声・負符号
]

# 報酬関数
# Maximizer: R = +λ*ΔIG - μ*ΔGED （正常な探索）
# Minimizer: R = -λ*ΔIG + μ*ΔGED （逆の挙動）
```

#### 期待される挙動

**正符号（Maximizer）**
- 未探索エリアへの積極的移動（ΔIG最大化）
- 壁破りは戦略的・最小限（ΔGED最小化）
- 効率的なリング状探索パターン
- 高いゴール到達率

**負符号（Minimizer）**
- 既知エリアに留まる傾向（ΔIG最小化）
- 無意味な壁破りの連発（ΔGED最大化）
- 探索の停滞または混沌とした動き
- 低いゴール到達率

#### 評価指標での期待値
| 指標 | 正符号 | 負符号 | 比率 |
|-----|-------|-------|------|
| 探索率 | 80-90% | 20-30% | 3-4x |
| ゴール到達率 | 90-100% | 0-20% | 5x+ |
| 壁破り回数 | 3-5 | 40-60 | 10x+ |
| 平均ΔIG | 0.7-0.8 | 0.1-0.2 | 4x+ |

### 統計的検証
- Mann-Whitney U検定：探索効率の有意差
- カイ二乗検定：ゴール到達率の差
- t検定：メトリクスの平均値比較
- **成功基準**: 全検定でp < 0.001

### 可視化計画

#### Figure 4: 符号逆転の決定的証拠
```
[A. 探索軌跡ヒートマップ]
Maximizer          Minimizer
[効率的な         [局所的で
 リング状探索]     混沌とした動き]

[B. メトリクス時系列]
ΔIG: ▅▆█▇▆▅▄▃▂    vs    ▂▁▂▁▂▁▂▁▂
ΔGED: ▂▂▃▂▂▂▂     vs    ▅▇█▆▇█▇▆

[C. 3モーダル×2符号の結果テーブル]
全モーダルで一貫した符号効果を示す
```

### 論文での位置づけ
「この符号逆転テストにより、我々の内発報酬が単なる実装の偶然ではなく、理論的に予測された通りの挙動を示すことを実証する。さらに、この効果が観測モーダルに依存しないことは、提案手法の普遍性を強く支持する。」

## 次のステップ
1. maze_env.py の基本実装
2. sign_flip_experiment.py の実装
3. 6条件での実験実行
4. 統計解析と可視化
5. 論文用図表の作成