# エピソード記憶とメッセージパッシング統合実験

## 実験目的

迷路探索タスクにおいて、エピソード記憶とメッセージパッシングを統合したgeDIGアルゴリズムの効果を検証し、特に以下の点を可視化する：

1. **行き止まり情報の伝播**: 行き止まりに到達した経験が分岐点での意思決定にどう活用されるか
2. **クエリの動的生成**: 分岐点で過去の経験から新しいクエリが生成される様子
3. **知識グラフの成長**: 探索と共に知識グラフが構築される過程

## 実験設計

### 1. 迷路環境

- **サイズ**: 10×10（適度な複雑さ）
- **構造**: T字路や十字路を含む迷路（DFSアルゴリズムで生成）
- **特徴**:
  - 複数の行き止まり
  - 明確な分岐点
  - ゴールまでの最適経路が存在

### 2. エピソード記憶の構造

```
Episode {
    query: str          # "ゴールに到達するには？" / "位置(x,y)で次の行動は？"
    context: Position   # クエリが発生した位置
    action: Action      # 実行した行動（上下左右）
    result: Position    # 行動の結果到達した位置
    outcome: Outcome    # 成功/壁衝突/行き止まり/ゴール到達
    value: float       # エピソードの価値（-10〜+10）
}
```

### 3. メッセージパッシングの仕組み

1. **行き止まり到達時**:
   - 経路上の全ての分岐点に「この方向は行き止まり」という情報を伝播
   - 分岐点のノードに負の価値を付与

2. **ゴール到達時**:
   - 経路上の全ての分岐点に「この方向はゴールへ通じる」という情報を伝播
   - 分岐点のノードに正の価値を付与

3. **分岐点での意思決定**:
   - 蓄積されたメッセージから新しいクエリを生成
   - 例: "位置(3,3)で、左と右は行き止まり。どちらに進むべき？"

### 4. ビジュアライゼーション

#### 4.1 リアルタイムビジュアライゼーション（動画/GIF）
- 左側: 迷路とエージェントの移動
- 右側: 知識グラフの構築過程
- 色分け:
  - 赤: 壁衝突・行き止まりエピソード
  - 黄: 初期ゴールクエリ
  - 白: メッセージパッシングによる行動指針
  - 青: 成功した移動エピソード
  - 金: 分岐点で生成された新クエリ

#### 4.2 スナップショット（静止画）
- 重要な時点でのスナップショット:
  1. 初期状態
  2. 最初の行き止まり発見
  3. 分岐点に戻ってクエリ生成
  4. 2つ目の行き止まり発見
  5. 最適経路の発見とゴール到達

### 5. 評価指標

1. **効率性**:
   - ゴール到達までのステップ数
   - 無駄な探索の削減率

2. **学習速度**:
   - 行き止まり情報の即座の活用
   - 同じミスを繰り返さない

3. **知識の質**:
   - 構築されたグラフの構造
   - エピソード間の関連性

## 実装計画

### Phase 1: 基本実装
1. エピソード記憶を持つナビゲーター
2. 迷路環境との統合
3. 基本的な行動選択アルゴリズム

### Phase 2: メッセージパッシング
1. 行き止まり情報の伝播機能
2. 分岐点での価値集約
3. 動的クエリ生成

### Phase 3: ビジュアライゼーション
1. リアルタイム描画システム
2. 知識グラフの可視化
3. エピソード間の関係表示

### Phase 4: 実験と分析
1. 複数の迷路での実験
2. パフォーマンス計測
3. 結果の分析とレポート作成

## 期待される成果

1. **メッセージパッシングの有効性の実証**
   - 行き止まり情報が効率的に活用される
   - 探索効率が大幅に向上

2. **「学習しながら推論する」パラダイムの具体例**
   - エピソード記憶から動的にクエリが生成される
   - 過去の経験が即座に活用される

3. **視覚的に分かりやすいデモ**
   - 知識グラフの成長過程
   - メッセージパッシングの動作
   - クエリ生成の瞬間

## 技術的注意点

1. **チートの回避**:
   - エージェントは隣接1マスのみ観測可能
   - 迷路の全体構造は知らない
   - 純粋にエピソード記憶とメッセージパッシングで解決

2. **公正な比較**:
   - ランダムウォーク
   - 単純な壁沿い探索
   - エピソード記憶のみ（メッセージパッシングなし）
   - メッセージパッシング統合版

3. **再現性**:
   - 乱数シード固定
   - 迷路生成アルゴリズムの明記
   - パラメータの文書化